<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventaire - Astoria</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Main inventory wrapper -->
    <div class="inventory-wrapper">
        <!-- Header with title and back button -->
        <div class="inventory-header">
            <a href="index.html" class="back-link" title="Retour √† la liste">‚Üê</a>
            <h1 class="inventory-title">Inventaire</h1>
            <div class="inventory-info">
                <span id="itemCount">0 objets</span>
            </div>
        </div>

        <!-- Category filter bar -->
        <div class="inventory-categories">
            <button class="category-btn active" data-category="all">
                <span class="category-icon">üì¶</span>
                <span class="category-label">Tous</span>
            </button>
            <button class="category-btn" data-category="equipement">
                <span class="category-icon">‚öîÔ∏è</span>
                <span class="category-label">√âquipements</span>
            </button>
            <button class="category-btn" data-category="consommable">
                <span class="category-icon">üß™</span>
                <span class="category-label">Consommables</span>
            </button>
            <button class="category-btn" data-category="agricole">
                <span class="category-icon">üåæ</span>
                <span class="category-label">Agricole</span>
            </button>
        </div>

        <!-- Main content area: grid + details -->
        <div class="inventory-content">
            <!-- Items grid (left side) -->
            <div class="inventory-grid-container">
                <div class="inventory-grid" id="inventoryGrid">
                    <!-- Items will be rendered here by JS -->
                </div>
                <div class="empty-inventory" id="emptyState" style="display: none;">
                    <div class="empty-state-icon">üì¶</div>
                    <div class="empty-state-title">Aucun objet</div>
                    <div class="empty-state-message">Votre inventaire est vide dans cette cat√©gorie</div>
                </div>
            </div>

            <!-- Item detail panel (right side) -->
            <div class="inventory-detail" id="itemDetail">
                <div class="detail-placeholder">
                    <div class="placeholder-icon">üëÜ</div>
                    <p>S√©lectionnez un objet pour voir ses d√©tails</p>
                </div>
                <!-- Details will be rendered here when item is selected -->
            </div>
        </div>
    </div>

    <!-- Load shared data -->
    <script src="data.js"></script>

    <!-- Inventory-specific JS -->
    <script>
        /**
         * INVENTORY MODULE
         * Handles category filtering, item selection, and detail display
         * Integrates with existing inventoryData from data.js
         */

        // --- STATE ---
        let currentCategory = 'all';
        let selectedItemIndex = null;
        let inventoryItems = [];

        // --- DOM REFERENCES ---
        const grid = document.getElementById('inventoryGrid');
        const detailPanel = document.getElementById('itemDetail');
        const emptyState = document.getElementById('emptyState');
        const itemCountEl = document.getElementById('itemCount');
        const categoryButtons = document.querySelectorAll('.category-btn');

        // --- INITIALIZATION ---
        // Load items from shared data.js (inventoryData)
        // In real app, you'd fetch from API or localStorage
        function initInventory() {
            // Use existing inventoryData from data.js
            if (typeof inventoryData !== 'undefined') {
                // Transform items to add quantity (dummy data for now)
                inventoryItems = inventoryData.map((item, index) => ({
                    ...item,
                    id: index,
                    quantity: Math.floor(Math.random() * 5) + 1 // Random qty 1-5
                }));
            } else {
                inventoryItems = [];
            }

            renderInventory();
        }

        // --- CATEGORY FILTERING ---
        function filterByCategory(category) {
            currentCategory = category;
            selectedItemIndex = null;

            // Update active button
            categoryButtons.forEach(btn => {
                if (btn.dataset.category === category) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });

            renderInventory();
        }

        // Attach click handlers to category buttons
        categoryButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                filterByCategory(btn.dataset.category);
            });
        });

        // --- RENDERING ---
        function renderInventory() {
            // Filter items by category
            let filtered = inventoryItems;
            if (currentCategory !== 'all') {
                filtered = inventoryItems.filter(item => item.category === currentCategory);
            }

            // Update count
            itemCountEl.textContent = `${filtered.length} objet${filtered.length > 1 ? 's' : ''}`;

            // Clear grid
            grid.innerHTML = '';

            // Show empty state if no items
            if (filtered.length === 0) {
                grid.style.display = 'none';
                emptyState.style.display = 'flex';
                showDetailPlaceholder();
                return;
            }

            // Show grid
            grid.style.display = 'grid';
            emptyState.style.display = 'none';

            // Render each item
            filtered.forEach((item, index) => {
                const card = createItemCard(item, index);
                grid.appendChild(card);
            });
        }

        function createItemCard(item, index) {
            const card = document.createElement('div');
            card.className = 'inventory-item';
            card.dataset.index = index;

            // Get image path (reuse logic from index.html)
            const imageSrc = item.image || 'data:image/svg+xml;utf8,' + encodeURIComponent(
                `<svg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'>` +
                `<rect width='80' height='80' fill='#fce4ec'/>` +
                `<text x='50%' y='50%' text-anchor='middle' fill='#d81b60' font-family='Arial' font-size='12'>?</text>` +
                `</svg>`
            );

            card.innerHTML = `
                <div class="item-image">
                    <img src="${escapeHtml(imageSrc)}" alt="${escapeHtml(item.name)}">
                </div>
                <div class="item-info">
                    <div class="item-name">${escapeHtml(item.name)}</div>
                    ${item.quantity > 1 ? `<div class="item-quantity">√ó${item.quantity}</div>` : ''}
                </div>
            `;

            // Click to select
            card.addEventListener('click', () => selectItem(item, card));

            return card;
        }

        // --- ITEM SELECTION ---
        function selectItem(item, cardElement) {
            // Remove previous selection
            document.querySelectorAll('.inventory-item').forEach(el => {
                el.classList.remove('selected');
            });

            // Mark as selected
            cardElement.classList.add('selected');
            selectedItemIndex = item.id;

            // Show details
            showItemDetail(item);
        }

        function showItemDetail(item) {
            const categoryLabels = {
                'equipement': '‚öîÔ∏è √âquipement',
                'consommable': 'üß™ Consommable',
                'agricole': 'üåæ Agricole'
            };

            const priceInfo = [];
            if (item.buyPrice) priceInfo.push(`Achat: ${item.buyPrice}`);
            if (item.sellPrice) priceInfo.push(`Vente: ${item.sellPrice}`);
            const priceText = priceInfo.length > 0 ? priceInfo.join(' | ') : 'Prix inconnu';

            detailPanel.innerHTML = `
                <div class="detail-header">
                    <h2 class="detail-title">${escapeHtml(item.name)}</h2>
                    <span class="detail-category">${categoryLabels[item.category] || 'Autre'}</span>
                </div>
                <div class="detail-image">
                    <img src="${escapeHtml(item.image || '')}" alt="${escapeHtml(item.name)}">
                </div>
                <div class="detail-body">
                    <div class="detail-section">
                        <span class="detail-label">Description</span>
                        <p class="detail-text">${escapeHtml(item.description || 'Aucune description disponible.')}</p>
                    </div>
                    ${item.effect ? `
                    <div class="detail-section">
                        <span class="detail-label">Effet</span>
                        <p class="detail-text detail-effect">${escapeHtml(item.effect)}</p>
                    </div>
                    ` : ''}
                    <div class="detail-section">
                        <span class="detail-label">Commerce</span>
                        <p class="detail-text">${escapeHtml(priceText)}</p>
                    </div>
                    ${item.quantity > 1 ? `
                    <div class="detail-section">
                        <span class="detail-label">Quantit√©</span>
                        <p class="detail-text">√ó${item.quantity}</p>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function showDetailPlaceholder() {
            detailPanel.innerHTML = `
                <div class="detail-placeholder">
                    <div class="placeholder-icon">üëÜ</div>
                    <p>S√©lectionnez un objet pour voir ses d√©tails</p>
                </div>
            `;
        }

        // --- UTILITIES ---
        function escapeHtml(str) {
            if (!str) return '';
            return String(str)
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;')
                .replace(/"/g, '&quot;')
                .replace(/'/g, '&#039;');
        }

        // --- ENTRY POINT ---
        // Call this when page loads
        // Later you can call renderInventory() to refresh with new data
        window.addEventListener('DOMContentLoaded', initInventory);

        // Expose for external use (if needed)
        window.InventoryModule = {
            renderInventory,
            filterByCategory,
            items: inventoryItems
        };
    </script>
</body>
</html>
